# 📉 LOSS（损失值）

## 一、什么是 LOSS？

在模型微调（Fine-tuning）中，**LOSS（损失函数）** 是一个可微的数学函数，用于衡量模型预测结果与真实目标之间的误差（输出为一个标量数值）。

> ✅ **目标：** 通过优化算法（如梯度下降）最小化 LOSS，使模型预测结果尽可能接近真实答案。

LOSS 值的高低直接反映模型的预测准确性。  
它的持续下降，是模型“在学习”的重要标志。

---

## 二、LOSS 的直观理解

| 问题 | 简单解释 |
|------|-----------|
| **LOSS 是什么？** | 模型在微调过程中“犯错的程度”的评分。数值越大，说明模型错得越离谱。 |
| **怎么算出来？** | 将模型的预测结果与正确答案进行比较，计算误差。 |
| **LOSS 值的作用？** | 微调就是想尽办法让这个“错误评分”越来越小。 |
| **怎么让它变小？** | 通过梯度下降算法调整模型的参数，使下次预测时误差减小。 |
| **为什么要关心它？** | 因为 LOSS 曲线能直观反映模型学习过程是否有效、是否稳定。 |

---

## 三、LOSS 的数学本质

LOSS 是一个标量函数：  
\[
L = f(\hat{y}, y)
\]
其中：
- \( \hat{y} \)：模型预测值  
- \( y \)：真实标签  
- \( L \)：损失函数输出的误差值  

常见的损失函数示例：
- 分类任务：交叉熵损失（CrossEntropy Loss）  
- 回归任务：均方误差（Mean Squared Error, MSE）  

---

## 四、如何通过 LOSS 优化模型？

1. **前向传播（Forward）**  
   模型根据输入数据预测输出结果。

2. **计算 LOSS**  
   比较预测值与真实标签，得到误差。

3. **反向传播（Backward）**  
   计算 LOSS 对每个参数的梯度。

4. **参数更新（Update）**  
   优化器根据梯度方向调整参数，使 LOSS 减小。

> 💡 这就是机器学习中最核心的循环：**Forward → Compute LOSS → Backward → Update**

---

## 五、如何判断 LOSS 是否正常？

| LOSS 曲线趋势 | 说明 |
|---------------|------|
| 📉 平稳下降 | 模型学习良好 |
| 📈 持续上升 | 学习率过高或训练不稳定 |
| 🪣 快速下降后不变 | 学习率太小或模型容量不足 |
| 🎢 剧烈波动 | 数据或梯度存在异常 |
| 🧱 降到极低但验证集变差 | 出现过拟合 |

> 一般来说，理想的 LOSS 区间在 **0.5～1.5** 之间（取决于任务类型与数据规模）。

---

## 六、SwanLab 可视化监控

**SwanLab** 是一个开源的训练跟踪与可视化工具，可用于记录训练过程、监控硬件资源、比较实验结果。

### 1️⃣ 开启 SwanLab

在 LLaMA Factory 中可以直接启用 SwanLab：

```bash
swanlab login
````

按提示粘贴从 [https://swanlab.cn/settings](https://swanlab.cn/settings) 获取的 **API Key**，登录完成后系统会自动保存。

---

### 2️⃣ 启动微调任务后

SwanLab 会生成在线监控地址，例如：

```
swanlab: Monitoring URL: https://swanlab.cn/project/your_project_name
```

打开链接可实时查看训练日志与指标变化。

---

### 3️⃣ 查看系统环境监控

SwanLab 还能显示：

* GPU / CPU 占用率
* 显存使用情况
* 当前训练速度与批次统计

---

## 七、训练监控：Train LOSS vs Eval LOSS

在模型训练过程中，损失函数（LOSS）是衡量模型性能的核心指标。如果在训练配置中设定了验证集比例，系统会自动生成两条关键曲线用于监控训练状态：

| 曲线类型 | 含义 | 监控重点 |
| :------- | :--- | :------- |
| **Train LOSS** | 模型在训练集上的误差，反映当前批次数据的学习情况 | 学习进度、收敛状态 |
| **Eval LOSS** | 模型在验证集上的误差，反映模型泛化能力 | 过拟合风险、泛化性能 |

### 理想训练状态

- ✅ **两者同步下降** → 模型正在有效学习，泛化能力提升
- ✅ **Eval LOSS 稍高于 Train LOSS** → 正常现象，表明模型未过拟合
- ⚠️ **Eval LOSS 开始上升而 Train LOSS 继续下降** → 过拟合信号

---

## 八、常见 LOSS 曲线形态与诊断

| 曲线形态 | 损失曲线表现 | 诊断说明 | 解决方案 |
| :------- | :----------- | :------- | :------- |
| **📉 正常收敛** | 两者同步稳定下降，最终趋于平稳 | 模型学习效果良好，训练充分 | 继续训练或按计划停止 |
| **🎢 震荡下降** | 损失值波动较大但总体呈下降趋势 | 学习率可能偏大，但训练仍有效 | 适当降低学习率或增加批量大小 |
| **🪣 平台停滞** | 损失值长期无明显下降 | 学习率过小、模型容量不足或陷入局部最优 | 调整学习率、增大模型规模或更改优化器 |
| **🧱 典型过拟合** | Train LOSS 持续下降，Eval LOSS 在某个节点开始上升 | 模型过度记忆训练数据，泛化能力下降 | 早停（Early Stopping）、增加正则化、数据增强 |
| **📈 欠拟合状态** | Train LOSS 和 Eval LOSS 均处于高位且无下降趋势 | 模型未能有效学习数据特征 | 增加训练轮次、增大模型容量、调整特征工程 |
| **🔀 分布异常** | Eval LOSS 持续下降，但 Train LOSS 居高不下 | 训练集与验证集数据分布差异较大 | 检查数据分割合理性，确保分布一致性 |
| **🚀 验证集偏易** | Eval LOSS 下降显著快于 Train LOSS | 验证集样本相对简单或分布不均衡 | 重新评估验证集构建，确保其代表性 |
