# 🧠 微调后模型使用及效果验证

## 📂 加载模型（通过 LoRA 适配器）

微调任务完成后，进入在启动微调时设定的 **输出目录**：

```bash
cd /root/autodl-tmp/models/security007
````

你将看到输出目录中包含如下文件结构：

| 类型         | 文件                                                  | 说明                    |
| ---------- | --------------------------------------------------- | --------------------- |
| **模型权重文件** | `adapter_model.safetensors`                         | LoRA 适配器权重（核心增量参数）    |
|            | `checkpoint-100/200/...`                            | 不同步数的训练检查点，用于恢复训练     |
| **配置文件**   | `adapter_config.json`                               | LoRA 训练配置（秩、目标层等）     |
|            | `tokenizer_config.json` / `special_tokens_map.json` | 分词器配置文件               |
|            | `training_args.yaml` / `training_args.bin`          | 训练超参数（学习率、批次等）        |
| **日志与结果**  | `trainer_log.jsonl` / `running_log.txt`             | 训练过程日志                |
|            | `all_results.json` / `train_results.json`           | 训练指标（loss、accuracy 等） |
|            | `training_loss.png`                                 | 损失曲线可视化图              |
| **分词器数据**  | `merges.txt`                                        | BPE 分词规则              |
|            | `tokenizer.json` / `vocab.json`                     | 分词器词表与编码规则            |
|            | `added_tokens.json`                                 | 训练中新增的自定义 Token       |

---

## ⚙️ LoRA 适配器机制说明

在 **LoRA 微调** 中，仅训练插入的低秩矩阵（适配器），原模型参数保持冻结不变。
因此输出目录中只包含 **LoRA 适配器** 的权重文件，而不包含完整模型参数。

👉 如果想得到 **完整微调后的模型**，需要手动 **合并适配器与原始模型**。

---

## ✅ 效果验证

我们可以在 **WebUI** 或脚本中快速验证模型效果。

1. **加载微调模型**

   * 模型路径填写微调前的基础模型路径；
   * 检查点路径填写微调输出目录。

2. **生成验证**

   * 适当调整最大生成长度（建议 > 1024），避免输出被截断。

3. **对比原始模型**

   * 去掉检查点路径重新加载模型；
   * 比较输出差异。

---

## 🔄 模型合并与导出

以上步骤适用于临时测试。
若要在后续使用中直接加载 **合并后的完整模型**，需执行模型合并与导出操作。

1. **加载模型并设定导出目录**

在界面或命令行中，填入：

* **检查点路径**：微调输出目录
* **模型路径**：基础模型路径
* **导出目录**：用于保存合并后模型的路径（可选设定量化等级、上传 Hugging Face 等）

2. **导出成功**

导出完成后，进入保存目录：

```bash
cd /root/autodl-tmp/save/Qwen2.5-7B-Instruct-Security
```

3. **验证导出结果**

清空检查点路径，将“合并后模型目录”填入模型路径，再次加载模型进行测试；

结果应与加载适配器时一致，说明模型合并成功 ✅

---

## 📘 总结

| 步骤  | 说明                |
| --- | ----------------- |
| 1️⃣ | 完成 LoRA 微调并生成输出目录 |
| 2️⃣ | 检查并了解输出文件内容       |
| 3️⃣ | 加载适配器验证模型效果       |
| 4️⃣ | 合并适配器与原始模型导出完整权重  |
| 5️⃣ | 验证导出模型输出一致性       |
