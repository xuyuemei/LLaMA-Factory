# âš™ï¸ å¾®è°ƒé€šç”¨è®¾ç½®ï¼ˆFine-tuning Settingsï¼‰

> æœ¬æ–‡æ¡£ä»‹ç»äº† LLM å¾®è°ƒçš„é€šç”¨é…ç½®ï¼ŒåŒ…æ‹¬æ¨¡å‹é€‰æ‹©ã€å¾®è°ƒæ–¹æ³•ã€é‡åŒ–æŠ€æœ¯ã€å¯¹è¯æ¨¡æ¿ä¸åŠ é€Ÿç­–ç•¥ç­‰å†…å®¹ã€‚

---

## ğŸ§­ ä¸€ã€é€‰æ‹©æ¨¡å‹ï¼ˆModel Selectionï¼‰

| åˆ†ç±» | æ ‡è¯† | å«ä¹‰ | ç¤ºä¾‹ |
| :-- | :-- | :-- | :-- |
| **åŠŸèƒ½ä¸ä»»åŠ¡ç±»å‹** | Base | åŸºç¡€æ¨¡å‹ï¼ˆåŸå§‹èƒ½åŠ›ï¼‰ | Qwen3-14B-Base |
|  | Chat | å¯¹è¯ä¼˜åŒ–æ¨¡å‹ | DeepSeek-LLM-7B-Chat |
|  | Instruct | æŒ‡ä»¤å¾®è°ƒæ¨¡å‹ | Qwen3-0.6B-Instruct |
|  | Distill | çŸ¥è¯†è’¸é¦æ¨¡å‹ | DeepSeek-R1-1.5B-Distill |
|  | Math | æ•°å­¦æ¨ç†æ¨¡å‹ | DeepSeek-Math-7B-Instruct |
|  | Coder | ç¼–ç¨‹ä»»åŠ¡æ¨¡å‹ | DeepSeek-Coder-V2-16B |
| **å¤šæ¨¡æ€** | VL | è§†è§‰-è¯­è¨€æ¨¡å‹ | Kimi-VL-A3B-Instruct |
|  | Video | è§†é¢‘å¤šæ¨¡æ€æ¨¡å‹ | LLaVA-NeXT-Video-7B-Chat |
|  | Audio | éŸ³é¢‘è¾“å…¥æ¨¡å‹ | Qwen2-Audio-7B |
| **æŠ€æœ¯ç‰¹æ€§** | Int8 / Int4 | æƒé‡é‡åŒ–æ¨¡å‹ | Qwen2-VL-2B-Instruct-GPTQ-Int8 |
|  | AWQ / GPTQ | ç‰¹å®šé‡åŒ–æŠ€æœ¯ | Qwen2.5-VL-72B-Instruct-AWQ |
|  | MoE | æ··åˆä¸“å®¶æ¨¡å‹ | DeepSeek-MoE-16B-Chat |
|  | RL | å¼ºåŒ–å­¦ä¹ ä¼˜åŒ–æ¨¡å‹ | MiMo-7B-Instruct-RL |
| **ç‰ˆæœ¬** | v0.1 / v0.2 | æ¨¡å‹ç‰ˆæœ¬å· | Mistral-7B-v0.1 |
| **å˜ä½“** | Pure | çº¯å‡€ç‰ˆæ¨¡å‹ | Index-1.9B-Base |
|  | Character | è§’è‰²å¯¹è¯æ¨¡å‹ | Index-1.9B-Character-Chat |
|  | Long-Chat | é•¿ä¸Šä¸‹æ–‡æ¨¡å‹ | Orion-14B-Long-Chat |
| **åº”ç”¨é¢†åŸŸ** | RAG | æ£€ç´¢å¢å¼ºç”Ÿæˆæ¨¡å‹ | Orion-14B-RAG-Chat |
|  | Chinese | ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹ | Llama-3-70B-Chinese-Chat |
|  | MT | ç¿»è¯‘æ¨¡å‹ | BLOOMZ-7B1-mt |

---

## ğŸ§  äºŒã€å¾®è°ƒæ–¹æ³•ï¼ˆFine-tuning Methodsï¼‰

### ğŸ§© 1. Fullï¼ˆå…¨å‚æ•°å¾®è°ƒï¼‰

- **æ¦‚å¿µ**ï¼šè®­ç»ƒå…¨éƒ¨å‚æ•°ï¼Œæœ€å¤§åŒ–æ€§èƒ½ã€‚  
- **ç±»æ¯”**ï¼šæ‹†æ‰æˆ¿å­é‡å»ºã€‚  
- **ä¼˜ç‚¹**ï¼šæ€§èƒ½æœ€å¼ºã€å®Œå…¨é€‚åº”æ€§é«˜ã€‚  
- **ç¼ºç‚¹**ï¼šæ˜¾å­˜ä¸è®¡ç®—é‡éœ€æ±‚æé«˜ã€‚  
- **é€‚ç”¨åœºæ™¯**ï¼šæœ‰å……è¶³ç®—åŠ›ã€æ•°æ®é‡å¤§ã€ä»»åŠ¡å·®å¼‚å¤§ã€‚

---

### ğŸ§± 2. Freezeï¼ˆå‚æ•°å†»ç»“å¾®è°ƒï¼‰

- **æ¦‚å¿µ**ï¼šå†»ç»“éƒ¨åˆ†å‚æ•°ï¼Œä»…è®­ç»ƒéƒ¨åˆ†å±‚ã€‚  
- **ç±»æ¯”**ï¼šç»™æˆ¿å­å±€éƒ¨è£…ä¿®ã€‚  
- **ä¼˜ç‚¹**ï¼šè®¡ç®—æ•ˆç‡é«˜ã€é˜²æ­¢è¿‡æ‹Ÿåˆã€èŠ‚çœå†…å­˜ã€‚  
- **ç¼ºç‚¹**ï¼šæ€§èƒ½ç•¥ä½ã€éœ€ä¸“ä¸šè°ƒå‚ã€‚  
- **é€‚ç”¨åœºæ™¯**ï¼šèµ„æºæœ‰é™ã€å°æ•°æ®é›†ã€ä»»åŠ¡ç›¸ä¼¼ã€‚

---

### ğŸ”— 3. LoRAï¼ˆä½ç§©é€‚é…å¾®è°ƒï¼‰

- **æ¦‚å¿µ**ï¼šé€šè¿‡æ³¨å…¥å°å‹å¯è®­ç»ƒçŸ©é˜µå®ç°é«˜æ•ˆå¾®è°ƒã€‚  
- **ç±»æ¯”**ï¼šç»™æˆ¿å­åŠ æ™ºèƒ½æ¨¡å—ã€‚  
- **ä¼˜ç‚¹**ï¼š
  - è®­ç»ƒå‚æ•°å‡å°‘ 99%+
  - æ˜¾å­˜å ç”¨ä½ã€è®­ç»ƒé€Ÿåº¦å¿«
  - é€‚é…å¤šä»»åŠ¡ä¸è½»é‡åŒ–éƒ¨ç½²
- **ç¼ºç‚¹**ï¼š
  - æ€§èƒ½ä¸Šé™ç•¥ä½
  - è¶…å‚æ•°è°ƒèŠ‚å¤æ‚
- **é€‚ç”¨åœºæ™¯**ï¼š
  - GPU èµ„æºæœ‰é™
  - å¿«é€Ÿé€‚é…æ–°ä»»åŠ¡
  - å¤šæ¨¡æ€æˆ–è¿­ä»£ä¼˜åŒ–åœºæ™¯

> ğŸ’¡ **LoRA å¾®è°ƒæ˜¯å½“å‰ä¸»æµæ–¹æ³•**  
> åœ¨ä¿æŒé¢„è®­ç»ƒæƒé‡ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒLoRA é€šè¿‡ä½ç§©çŸ©é˜µå­¦ä¹ ç‰¹å®šä»»åŠ¡ç‰¹å¾ï¼Œå®ç°å¿«é€Ÿæ”¶æ•›ã€ä½æ˜¾å­˜å ç”¨ä¸è‰¯å¥½æ³›åŒ–æ€§èƒ½ã€‚

---

## ğŸ§® ä¸‰ã€æ¨¡å‹é‡åŒ–ï¼ˆModel Quantizationï¼‰

æ¨¡å‹é‡åŒ–ä¸è’¸é¦åŒå±äº **æ¨¡å‹å‹ç¼©ï¼ˆModel Compressionï¼‰** æŠ€æœ¯ã€‚  
é€šè¿‡é™ä½å‚æ•°ç²¾åº¦ï¼Œå¯åœ¨**è½»å¾®ç²¾åº¦æŸå¤±**ä¸‹æ˜¾è‘—å‡å°‘æ˜¾å­˜ä¸è®¡ç®—éœ€æ±‚ã€‚

---

### ğŸŒ 1. ä»€ä¹ˆæ˜¯æ¨¡å‹é‡åŒ–ï¼Ÿ

é‡åŒ–æ˜¯æŒ‡**ç”¨æ›´å°‘çš„æ¯”ç‰¹è¡¨ç¤ºæ¨¡å‹æƒé‡ä¸æ¿€æ´»å€¼**ã€‚  
ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯â€œç”¨æ›´å°çš„æ–‡ä»¶ä¿å­˜æ¨¡å‹â€ã€‚

> ğŸ§ ç±»æ¯”ï¼š
> - FLAC â†’ FP32 ç²¾åº¦æ¨¡å‹ï¼ˆé«˜ä¿çœŸï¼‰  
> - MP3 â†’ INT8 / INT4 é‡åŒ–æ¨¡å‹ï¼ˆæ›´è½»ä½†æœ‰å‹ç¼©ï¼‰

---

### ğŸ§© 2. æ¨¡å‹å‚æ•°ç²¾åº¦æ ¼å¼

| ç²¾åº¦ç±»å‹ | ç¤ºä¾‹ | å«ä¹‰ | ç‰¹ç‚¹ |
|-----------|--------|------|------|
| **FPï¼ˆFloating Pointï¼‰** | FP16 / FP32 | æµ®ç‚¹æ•°æ ¼å¼ | é«˜ç²¾åº¦ï¼Œå ç”¨æ˜¾å­˜å¤š |
| **BFï¼ˆBrain Floating Pointï¼‰** | BF16 | ä¸ºæ·±åº¦å­¦ä¹ ä¼˜åŒ–çš„æµ®ç‚¹æ ¼å¼ | ç²¾åº¦ä¸æ•ˆç‡å¹³è¡¡ |
| **INTï¼ˆIntegerï¼‰** | INT8 / INT4 | æ•´æ•°é‡åŒ– | æä½æ˜¾å­˜å ç”¨ï¼Œç²¾åº¦ç•¥é™ |

ğŸ’¡ **å†…å­˜å ç”¨å·®å¼‚ï¼š**
- FP32ï¼š4 å­—èŠ‚ / å‚æ•°  
- FP16ï¼š2 å­—èŠ‚ / å‚æ•°  
- INT8ï¼š1 å­—èŠ‚ / å‚æ•°  

---

### âš™ï¸ 3. QLoRA ç®€ä»‹

> **QLoRAï¼ˆQuantized LoRAï¼‰** = **LoRA + 4-bit åŠ¨æ€é‡åŒ–**

é€šè¿‡ï¼š
- 4-bit é‡åŒ–åŸºç¡€æ¨¡å‹  
- åŒé‡åŒ–ä¸è®­ç»ƒæ—¶åé‡åŒ–æœºåˆ¶  

QLoRA å®ç°ï¼š
- ğŸš€ æ˜¾å­˜å ç”¨æä½  
- âœ… ä¿ç•™æ¢¯åº¦ç²¾åº¦  
- ğŸ’¨ è®­ç»ƒæ•ˆç‡æé«˜  

> ğŸ“Œ åœ¨ LLaMA Factory ä¸­ï¼Œå½“é€‰æ‹© â€œ4-bit é‡åŒ–â€ æ—¶ï¼Œé»˜è®¤å¯ç”¨çš„å°±æ˜¯ **QLoRA å¾®è°ƒæ–¹æ³•**ã€‚

---

## ğŸ’¬ å››ã€å¯¹è¯æ¨¡æ¿ï¼ˆConversation Templateï¼‰

å¯¹è¯æ¨¡æ¿ç”¨äºå®šä¹‰æ¨¡å‹çš„è¾“å…¥æ ¼å¼ï¼Œä½¿è®­ç»ƒä¸æ¨ç†ä¿æŒä¸€è‡´ã€‚

---

### ğŸ§© 1. ä¸»è¦ä½œç”¨

1. **è®­ç»ƒ-æ¨ç†ä¸€è‡´æ€§**ï¼šç¡®ä¿è¾“å…¥ç»“æ„ä¸€è‡´ï¼Œé˜²æ­¢æ€§èƒ½ä¸‹é™ã€‚  
2. **ä¸Šä¸‹æ–‡ç®¡ç†**ï¼šåŒºåˆ† `User` / `Assistant` / `System`ã€‚  
3. **æ”¯æŒé«˜çº§åŠŸèƒ½**ï¼šç³»ç»Ÿæç¤ºã€æ€ç»´é“¾ã€å·¥å…·è°ƒç”¨ã€å¤šæ¨¡æ€è¾“å…¥ç­‰ã€‚

---

### ğŸ§± 2. Qwen æ¨¡æ¿ç¤ºä¾‹

```python
register_template(
    name="qwen",
    format_user=StringFormatter(slots=["<|im_start|>user\n{{content}}<|im_end|>\n<|im_start|>assistant\n"]),
    format_assistant=StringFormatter(slots=["{{content}}<|im_end|>\n"]),
    format_system=StringFormatter(slots=["<|im_start|>system\n{{content}}<|im_end|>\n"]),
    format_function=FunctionFormatter(slots=["{{content}}<|im_end|>\n"], tool_format="qwen"),
    format_observation=StringFormatter(
        slots=["<|im_start|>user\n<tool_response>\n{{content}}\n</tool_response><|im_end|>\n<|im_start|>assistant\n"]
    ),
    format_tools=ToolFormatter(tool_format="qwen"),
    default_system="You are Qwen, created by Alibaba Cloud. You are a helpful assistant.",
    stop_words=["<|im_end|>"],
    replace_eos=True,
)
````

---

### ğŸ“œ 3. æ ¼å¼åŒ–ç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥ï¼š**

> å¸®æˆ‘å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—

**æ ¼å¼åŒ–åï¼š**

```
<|im_start|>system
You are Qwen, created by Alibaba Cloud. You are a helpful assistant.
<|im_end|>

<|im_start|>user
å¸®æˆ‘å†™ä¸€é¦–å…³äºæ˜¥å¤©çš„è¯—
<|im_end|>

<|im_start|>assistant
```

---

## âš¡ äº”ã€åŠ é€Ÿæ–¹å¼ï¼ˆAcceleration Methodsï¼‰

LLaMA Factory æ”¯æŒå¤šç§åŠ é€Ÿæœºåˆ¶ï¼š

| åŠ é€Ÿæ–¹æ³•                 | è¯´æ˜                      | é…ç½®å‚æ•°                        |
| -------------------- | ----------------------- | --------------------------- |
| **FlashAttention-2** | æé«˜æ³¨æ„åŠ›è®¡ç®—é€Ÿåº¦ã€å‡å°‘æ˜¾å­˜å ç”¨        | `flash_attn: fa2`           |
| **Unsloth**          | ä¼˜åŒ– QLoRA / LoRA å¾®è°ƒé€Ÿåº¦ä¸æ˜¾å­˜ | `use_unsloth: True`         |
| **Liger Kernel**     | æå‡ååé‡ä¸æ˜¾å­˜æ•ˆç‡              | `enable_liger_kernel: True` |

> âš™ï¸ **æ¨èé…ç½®**
>
> * è‹¥ç¡¬ä»¶èµ„æºæœ‰é™ï¼š`Unsloth + 4-bit é‡åŒ–`
> * è‹¥æ€§èƒ½è¦æ±‚ä¸€èˆ¬ï¼šé»˜è®¤ `FlashAttention-2`
